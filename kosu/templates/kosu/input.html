{% load static %}
<!doctype html>
<html lang="ja">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>{{title}}</title>
    <link rel="icon" type="image/x-icon" href="{% static 'kosu/img/memo.png' %}">
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js@3.5.1/dist/chart.min.js"></script>
    <script src="{% static 'kosu/js/jquery-clock-timepicker.js' %}"></script>
    <script src="{% static 'kosu/js/form_post_stop.js' %}"></script>
    <script src="{% static 'kosu/js/over_time_display.js' %}"></script>
    <script src="{% static 'kosu/js/clock_setting.js' %}"></script>
    <script src="{% static 'kosu/js/now_time.js' %}"></script>
    <script src="{% static 'kosu/js/check_storage2.js' %}"></script>
    {% if member_obj.def_prediction == True %}
      <script src="{% static 'kosu/js/def_prediction.js' %}"></script>
    {% endif %}
    <link rel="stylesheet" type="text/css" href="{% static 'kosu/css/console.css' %}">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet" crossorigin="anonymous">
    <link rel="stylesheet" type="text/css" href="{% static 'kosu/css/bootstrap.css' %}">
    <link rel="stylesheet" type="text/css" href="{% static 'kosu/css/custom.css' %}">
    <link rel="stylesheet" type="text/css" href="{% static 'kosu/css/input_finish.css' %}">
    <link rel="stylesheet" type="text/css" href="{% static 'kosu/css/over_time.css' %}">
  </head>
  <body>
    <div id="content" class="container content">
      <div id="success-message"><span>工数登録完了</span></div>
      <h1 class="display-6 text-primary">{{member_obj.name}}さんの{{title}}</h1>
      <div class="number-input-group">
        <p class="h6 no-wrap">
          <a href="{% url 'kosu_main' %}">工数MENUへ</a>　　
          <a href="{% url 'kosu_list' 1 %}">履歴へ</a>　　
          {% if obj_link == True %}
            <a href="{% url 'detail' obj_get.id %}">工数編集</a>　　
          {% endif %}
          <a href="{% url 'main' %}">メインMENUへ</a>
        </p>
      </div>
      {% if def_alarm == True %}
        <h1 class="display-6 text-danger">ーーー　警告　ーーー</h6>
        <P class="fs-6 text-danger">
          工数区分定義が古い定義になっています。<br>
          定義変更前の過去の業務工数を打つなどの特別な目的がない場合は定義のバージョンを切り替えて下さい。<br>
          (手動で切り替えるかログインし直すと最新の定義が設定されます。)
        </p>
      {% endif %}
      <form id="work-form" action="{% url 'input' %}" method="post">
        {% csrf_token %}
        {% for message in messages %}
          <div {% if message.tags %}class="{{ message.tags }}"{% endif %}>
            <p class="text-danger">
              {{ message }}
            </p>
          </div>
        {% endfor %}
        <table class="table table-custom no-wrap">
          <tr>
            <th class="d-none d-md-table-cell" style="text-align:center;">
              就業日・勤務・直
            </th>
            <th style="text-align:center;" class="d-table-cell d-md-none">
              就業日
            </th>
            <td>
              <div class="number-input-group">
                <input type="date" class="form-control custom-border" style="width: 210px;" name="work_day" id="work_day" value={{new_day}}>　
                <div class="d-none d-md-table-cell"><div class="number-input-group">{{form.work}}　{{form.tyoku}}　</div></div>
                {% if OK_NG == True %}
                  <b class="text-primary h4">OK</b>
                {% else %}
                  <b class="text-danger h4">NG</b>
                {% endif %}
              </div>
            </td>
          </tr>
          <tr>
            <th class="d-table-cell d-md-none" style="text-align:center;">
              勤務
            </th>
            <td class="d-table-cell d-md-none">
              {{form.work2}}
            </td>
          </tr>
          <tr>
            <th class="d-table-cell d-md-none" style="text-align:center;">
              勤務直
            </th>
            <td class="d-table-cell d-md-none">
              {{form.tyoku2}}
            </td>
          </tr>
          <tr>
            <th style="text-align:center;">
              作業時間<br>
              <input type="submit" value="現在時刻"  name="now_time" class="btn btn-blue7 mt-2 d-table-cell d-md-none">
            </th>
            <td>
              <div class="number-input-group">
                <input class="your-time-field form-control custom-border" style="width : 90px;" type="text" id="start_time" name="start_time" data-precision="5" value={{default_start_time}}>
                ～
                <input class="your-time-field form-control custom-border" style="width : 90px;" type="text" id="end_time" name="end_time" data-precision="5" value={{default_end_time}}>　
                <div class="form-check form-check-inline custom-checkbox">
                  {{form.tomorrow_check.label}}{{form.tomorrow_check}}
                </div>
                <p class="d-none d-md-table-cell">　　　　</p>
                <input type="submit" value="現在時刻" id="now_time_button" name="now_time" class="btn btn-blue7 mt-2">
              </div>
            </td>
          </tr>
          <tr>
            <th style="text-align:center;">
              作業詳細
            </th>
            <td>
              <div class="number-input-group">
                {{form.work_detail}}　
                <div class="form-check form-check-inline custom-checkbox">
                  {{form.def_prediction}}
                </div>
                <input type="submit" value="区分予測入"  name="def_check" class="btn btn-blue9 mt-2 btn-sm">
              </div>
            </td>
          </tr>
          <tr>
            <th style="text-align:center;">
              業務区分
            </th>
            <td>
              <div class="number-input-group">
                {{form.kosu_def_list}}
                <input type="submit" value="定義確認"  name="def_find" class="btn btn-green4 mt-2 btn-sm">
              </div>
            </td>
          </tr>
          <tr>
            <th style="text-align:center;">
              残業
            </th>
            <td>
              <div class="number-input-group">
                <button type="button" class="custom-button" onclick="decrement(this)">-</button>
                {{ form.over_work }}
                <button type="button" class="custom-button" onclick="increment(this)">+</button>　　
                <input type="submit" value="残業のみ修正"  name="over_time_correction" class="btn btn-blue7 mt-2 btn-sm">
              </div>
            </td>
          </tr>
          <tr>
            <th style="text-align:center;">
              休憩変更
            </th>
            <td>
              <div class="form-check form-check-inline custom-checkbox">
                {{form.break_change}}
                (休憩時間工数入力可)
              </div>
            </td>
          </tr>
          <tr><th><td>
            <div class="number-input-group">
              <input type="submit" value="工数登録"  name="Registration" class="btn btn-blue8 mt-2">　　　
              <input type="submit" value="休憩変更登録"  name="change_display" class="btn btn-blue7 mt-2">
            </div>
          </td></th></tr>
          <button id="update" name="update" class="btn btn-link"></button>
          <script src="{% static 'kosu/js/graph_update.js' %}"></script>
        </table>
        {% if obj_link != '' %}
          <table class="table no-wrap">
            <tr>
              <th style="text-align:center;">
                工数詳細
              </th>
              <th style="text-align:center;">
                工数区分
              </th>
            </tr>
            {% for i in time_display_list %}
              <tr>
                {% for k in i %}
                  <div class="number-input-group">
                    <td style="text-align:center;">
                      {{k}}
                    </td>
                  </div>
                {% endfor %}
              </tr>
            {% endfor %}
            <tr>
              <div class="number-input-group">
                <td style="text-align:center;">
                  工数合計(基準時間)
                </td>
                <td style="text-align:center;">
                  {{time_total}}分({{default_total}}分)
                </td>
              </div>
            </tr>
          </table>
        {% endif %}
        {% if show_message %}
          <script src="{% static 'kosu/js/completion_message.js' %}"></script>
        {% endif %}
      </form>
      <div style="width:100%">
        <canvas id="chart1" height="100pt"></canvas>
      </div>

      {% if member_obj.def_prediction == True %}
        <script>
          const dynamicChoicesUrl = "{% url 'dynamic_choices' %}";
          const allChoicesUrl = "{% url 'all_choices' %}";
          const csrfToken = "{{ csrf_token }}";
        </script>
      {% endif %}

      <script>
        var label_list1 = [];
        var data_list1 = [];
      </script>
      {% for i in graph_item %}
        <script>
          label_list1.push("{{ i }}");
        </script>
      {% endfor %}
      {% for n in graph_list %}
        <script>
          data_list1.push("{{ n }}");
        </script>
      {% endfor %}
      <script src="{% static 'kosu/js/time_graph.js' %}"></script>
      {% for key, value in def_library.items %}
        {% if def_n > forloop.counter0 %}
          <p>
            <svg width="10%" height="20">
              <rect x="10" y="5" width="10" height="10" fill="{{key}}" rx="5" ry="5" />
            </svg>
            {{value}}
          </p>
        {% endif %}
      {% endfor %}
    </div>
    <div id="consoleDiv"></div>
  </body>
</html>